---
title: TCP的拥塞控制
date: 2018-01-29 21:11:28
categories: "网络协议" 
tags: [TCP,网络协议]
---

## 简介

拥塞，简单来说就是网络的负载相当繁重时，造成网络性能的损失。拥塞控制就是防止过多的数据注入网络中，使网络中的路由器或链路不致过载。拥塞控制就是防止过多的数据注入网络，避免网络拥塞。

<!-- more -->

##  流控制和拥塞控制的比较

**流控制**与**拥塞控制**是两个不同的概念。流控制是为了确保数据在到达目的端后，有一片**可用的缓存区**。拥塞控制主要关心如何降低网络的负载。流控制所解决的问题是防止**目的端的资源**成为瓶颈。而拥塞控制是为了避免网络中的**路由器和链路**成为瓶颈。流控制是连接双方的准则，而拥塞控制是全网的准则。



## 拥塞控制的算法

拥塞控制主要包括四种算法：慢开始、拥塞避免、快重传和快恢复。

### 慢开始和拥塞避免

发送方维持了一个叫拥塞窗口的状态变量。拥塞窗口的大小取决于网络的拥塞程度，并且动态地变化。

#### 慢开始

慢开始的思路是：不要一开始就发送大量的数据，先探测一下网络的拥塞程度，也就是说由小到大逐渐增大拥塞窗口的大小。慢开始算法的**工作过程**：

1. 用报文个数作为窗口大小的单位（TCP实际上是用字节作为窗口的单位）;
2. 一开始发送放设置cwnd(拥塞窗口大小)为1，发送报文M1;
3. 发送方收到接收方发过来的对M1的确认后，cwnd从1，变为2，发送M2,M3;
4. 发送方收到接收方发过来的对M2,M3的确认后，cwnd变为4，发送M4~M7，每经过一次传输轮次，窗口的大小就会加倍；

#### 慢开始与拥塞避免的切换

为了防止慢开始增长过大引起网络阻塞，需要设置一个**慢开始门限**ssthresh变量，使用方法如下：

1. 当cwnd < ssthresh时，使用慢开始算法；
2. 当cwnd > ssthresh时，改用拥塞避免算法；
3. .当cwnd = ssthresh时，慢开始于拥塞避免选择；

#### 拥塞避免

拥塞控制算法让拥塞窗口缓慢增长，即每经过一个传输轮次，拥塞窗口大小加1，而不是加倍。
无论是在慢开始阶段还是拥塞避免阶段，只要发送放判断网络出现拥塞（根据就是没有按时收到确认），就把慢开始门限ssthresh设置为出现拥塞时的一半，发送放的拥塞窗口cwnd重新设为1，执行慢开始算法。这样做的目的是减少发送到网络的分组数。让路由器有足够的时间把队列中积压的分组处理完。

> 注意：用数据报个数，知识方便讨论，实际上应该是**报文数**。

### 快重传和快恢复

#### 快重传的思路

快重传要求接收方每收到一个失序的报文段后立即发出重复确认（为的是使发送放及早知道有报文段没有到达对方），而不是等到自己发送数据时才进行捎带确认。使用场景如下：

1. 接收方收到了M1和M2后分别发出了确认；
2. 假定接收方没有收到M3但接着收到了M4，接收方不能确认M4,因为M4是失序的报文；
3. 按照快重传的要求，接收方马上发送一个对M2的重复确认；
4. 发送放接着发送M5和M6，接收方收到后，也还要再次发出对M2的重复确认；
5. 快重传规定，发送方只要一连收到三个重复确认，就应当立即重传未收到的报文段M3，而不必等待M3设置的重传计时器到期

#### 快恢复的使用

快恢复与快重传搭配使用，当发送方连续收到三个重复确认时，就执行“乘法较小”算法，把慢开始门限ssthresh减半。然后执行拥塞控制算法，缓慢增大。

## 参考资料

[《计算机网络》](https://book.douban.com/subject/2970300/) 